<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offline Image Captioning Demo</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<style>
  body { font-family: Arial; padding: 20px; }
  #imgPreview { max-width: 300px; margin-top: 10px; display:block; }
</style>
</head>
<body>

<h2>Offline Image Captioning Demo</h2>
<input type="file" id="imgInput" accept="image/*">
<img id="imgPreview" />
<p id="caption">Описание изображения появится здесь...</p>

<script>
const imgInput = document.getElementById('imgInput');
const imgPreview = document.getElementById('imgPreview');
const captionEl = document.getElementById('caption');

let model;

// Загружаем MobileNet при старте
async function loadModel() {
  model = await tf.loadGraphModel(
    'https://tfhub.dev/google/tfjs-model/imagenet/mobilenet_v2_140_224/classification/3/default/1',
    {fromTFHub:true}
  );
  console.log('Энкодер загружен');
}

imgInput.addEventListener('change', async (event) => {
  const file = event.target.files[0];
  if (!file) return;

  imgPreview.src = URL.createObjectURL(file);
  await imgPreview.decode();

  // Преобразуем изображение в тензор
  const tensor = tf.browser.fromPixels(imgPreview)
                  .resizeBilinear([224,224])
                  .expandDims()
                  .div(255);

  // Получаем предсказания
  const predictions = model.predict(tensor);
  const data = await predictions.data();

  // Находим индекс максимального значения
  const maxIdx = data.indexOf(Math.max(...data));

  // Простая заглушка: описание по классу
  captionEl.innerText = `Это изображение класса №${maxIdx} (демо)`;
});

// Загружаем модель при старте
loadModel();
</script>

</body>
</html>
