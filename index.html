<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>ИИ с интерактивным помощником</title>
<style>
body { font-family: Arial; background: #f0f0f0; }
.container { max-width: 700px; margin: 30px auto; padding: 20px; background: #fff; border-radius: 10px; }
.chat-box { height: 250px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: #fafafa; }
input { width: calc(100% - 110px); padding: 10px; margin-right: 5px; }
button { padding: 10px; width: 100px; margin-bottom: 5px; }
.message { margin-bottom: 10px; }
.user { font-weight: bold; }
.bot { color: #007bff; }
#trainingToggle { margin-bottom: 10px; }
.assistant-log { font-size: 0.9em; color: #555; margin-bottom: 10px; }
.phrases-box { max-height: 120px; overflow-y: auto; border: 1px solid #ccc; padding: 5px; margin-bottom: 10px; background: #eef; }
.phrase-item { display: flex; justify-content: space-between; margin-bottom: 3px; }
#assistantChat { display: none; border: 1px solid #aaa; padding: 10px; margin-bottom: 10px; background: #fdfdfd; }
</style>
</head>
<body>
<div class="container">
<h1>ИИ с интерактивным помощником</h1>

<button id="trainingToggle">Включить обучение</button>
<div class="assistant-log" id="assistantLog">Обучение выключено</div>

<h2>Основной чат</h2>
<div class="chat-box" id="chatBox"></div>
<input type="text" id="userInput" placeholder="Введите сообщение..." />
<button id="sendBtn">Отправить</button>

<h3>Список обученных фраз:</h3>
<div class="phrases-box" id="phrasesBox"></div>

<div id="assistantChat">
<h2>Чат с помощником</h2>
<div class="chat-box" id="assistantBox"></div>
<input type="text" id="assistantInput" placeholder="Введите фразу для обучения..." />
<button id="assistantSend">Добавить в обучение</button>
</div>
</div>

<script>
const chatBox = document.getElementById("chatBox");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const trainingToggle = document.getElementById("trainingToggle");
const assistantLog = document.getElementById("assistantLog");
const phrasesBox = document.getElementById("phrasesBox");

const assistantChatDiv = document.getElementById("assistantChat");
const assistantBox = document.getElementById("assistantBox");
const assistantInput = document.getElementById("assistantInput");
const assistantSend = document.getElementById("assistantSend");

let trainingEnabled = false;
let chatHistory = JSON.parse(localStorage.getItem("chatHistory")) || [];
let trainedPhrases = JSON.parse(localStorage.getItem("trainedPhrases")) || [];

// --- Рендер обученных фраз ---
function renderPhrases() {
  phrasesBox.innerHTML = '';
  trainedPhrases.forEach((phrase, idx) => {
    const div = document.createElement('div');
    div.className = 'phrase-item';
    div.innerHTML = `<span>${phrase}</span><button onclick="removePhrase(${idx})">Удалить</button>`;
    phrasesBox.appendChild(div);
  });
}

function removePhrase(idx) {
  trainedPhrases.splice(idx,1);
  localStorage.setItem("trainedPhrases", JSON.stringify(trainedPhrases));
  renderPhrases();
}

// --- Показ истории основного чата ---
chatHistory.forEach(msg => addMessage(chatBox, msg.sender, msg.text, msg.className));
renderPhrases();

trainingToggle.addEventListener("click", () => {
  trainingEnabled = !trainingEnabled;
  trainingToggle.innerText = trainingEnabled ? "Выключить обучение" : "Включить обучение";
  assistantLog.innerText = trainingEnabled ? "Обучение включено" : "Обучение выключено";
  assistantChatDiv.style.display = trainingEnabled ? "block" : "none";
});

// --- Основной чат ---
sendBtn.addEventListener("click", ()=>sendMessage());
userInput.addEventListener("keydown", e => { if(e.key==="Enter") sendMessage(); });

function sendMessage() {
  const text = userInput.value.trim();
  if(!text) return;
  addMessage(chatBox, "Вы", text, "user");
  chatHistory.push({sender:"Вы", text, className:"user"});
  localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
  userInput.value = "";

  const reply = generateResponse(text);
  addMessage(chatBox, "ИИ", reply, "bot");
  chatHistory.push({sender:"ИИ", text:reply, className:"bot"});
  localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
}

// --- Чат с помощником ---
assistantSend.addEventListener("click", ()=>teachModel());
assistantInput.addEventListener("keydown", e => { if(e.key==="Enter") teachModel(); });

function teachModel() {
  const text = assistantInput.value.trim();
  if(!text) return;
  addMessage(assistantBox, "Вы (обучение)", text, "user");
  trainedPhrases.push(text);
  localStorage.setItem("trainedPhrases", JSON.stringify(trainedPhrases));
  renderPhrases();
  assistantInput.value = "";
  addMessage(assistantBox, "Помощник", "Фраза добавлена для обучения.", "bot");
}

// --- Генерация ответа основной модели ---
function generateResponse(userText){
  if(trainedPhrases.length>0){
    const count = Math.min(trainedPhrases.length, Math.floor(Math.random()*2)+1);
    let phrases = [];
    for(let i=0;i<count;i++){
      const idx = Math.floor(Math.random()*trainedPhrases.length);
      phrases.push(trainedPhrases[idx]);
    }
    return phrases.join(' ');
  }
  const text = userText.toLowerCase();
  if(text.includes("привет")) return "Привет! Как дела?";
  if(text.includes("как дела")) return "У меня всё хорошо, спасибо!";
  if(text.includes("пока")) return "До встречи!";
  return "Интересно...";
}

// --- Функция добавления сообщений ---
function addMessage(box, sender, text, className){
  const div = document.createElement("div");
  div.className = `message ${className}`;
  div.innerHTML = `<strong>${sender}:</strong> ${text}`;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}
</script>
</body>
</html>
