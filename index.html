<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offline Image Captioning (Demo)</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  #imgPreview { max-width: 300px; margin-top: 10px; display:block; }
  #caption { margin-top: 20px; font-size: 1.2em; font-weight: bold; }
</style>
</head>
<body>

<h2>Offline Image Captioning (Demo)</h2>
<input type="file" id="imgInput" accept="image/*">
<img id="imgPreview" />
<p id="caption">Описание изображения появится здесь...</p>

<script>
const imgInput = document.getElementById('imgInput');
const imgPreview = document.getElementById('imgPreview');
const captionEl = document.getElementById('caption');

let model;

async function loadModel() {
  model = await mobilenet.load();
  console.log('MobileNet загружен');
}

imgInput.addEventListener('change', async (event) => {
  const file = event.target.files[0];
  if (!file) return;

  imgPreview.src = URL.createObjectURL(file);
  await imgPreview.decode();

  // Получаем предсказание
  const predictions = await model.classify(imgPreview);

  // Берем топ-1 и делаем русский шаблон
  if(predictions.length > 0){
    const className = predictions[0].className;
    const probability = Math.round(predictions[0].probability * 100);
    captionEl.innerText = `На изображении похоже на "${className}" с вероятностью ${probability}%`;
  } else {
    captionEl.innerText = 'Не удалось определить объект на изображении.';
  }
});

// Загружаем модель при старте
loadModel();
</script>

</body>
</html>
